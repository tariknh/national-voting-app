<!DOCTYPE html>
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    var httpContext = HttpContextAccessor.HttpContext;
    var isAuthenticated = httpContext?.User?.Identity?.IsAuthenticated ?? false;
    var userName = httpContext?.User?.Identity?.Name ?? httpContext?.Session.GetString("UserFullName");
}

<html lang="no">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Digital Valgportal</title>

    <!-- CSS -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.designsystemet.no/css/main.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/WebApplication1.styles.css" asp-append-version="true" />

    @await RenderSectionAsync("Styles", required: false)

    <!-- Accessibility meta -->
    <meta name="theme-color" content="#00205b" />
</head>
<body class="no-scroll">
    <!-- Skip to content for accessibility -->
    <a href="#main-content" class="skip-link">Hopp til hovedinnhold</a>

    <!-- HEADER -->
    <header class="navbar-container">
        <div class="skip-link"><a href="#main-content">Hopp til hovedinnhold</a></div>
        <div class="nav-content">
            <div class="brand">
                <a asp-controller="Home" asp-action="Index" class="logo-link">
                    <span class="logo-text">Digital Valgportal</span>
                </a>
            </div>
            
            <!-- Mobile menu button -->
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Åpne meny" aria-expanded="false">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <!-- Navigation (hidden on mobile until toggled) -->
            <nav class="primary-nav" id="primaryNav">
                <ul>
                    <li><a asp-controller="Home" asp-action="Index">Hjem</a></li>
                    <li><a asp-controller="Map" asp-action="Index">Valgkart</a></li>
                    <li><a asp-controller="Home" asp-action="Privacy">Personvern</a></li>
                    <li><a asp-controller="Home" asp-action="Contact">Kontakt</a></li>
                    <li><a asp-controller="Home" asp-action="Accessibility">Tilgjengelighet</a></li>
                </ul>
            </nav>
            
            <div class="nav-actions" id="navActions">
                <a href="#" class="lang-switch" aria-label="Switch to English">EN</a> |
                <a href="#" class="lang-switch" aria-label="Switch to Norwegian">NO</a>
                @if (!isAuthenticated)
                {
                    <a asp-controller="Home" asp-action="Login" class="login-btn">Logg inn</a>
                }
                else
                {
                    <span class="fw-semibold user-greeting">@(!string.IsNullOrWhiteSpace(userName) ? $"Hei, {userName}" : "Du er innlogget")</span>
                    <a class="btn btn-outline-danger btn-sm" asp-controller="Home" asp-action="Logout">Logg ut</a>
                }
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <div class="container my-4">
        <main id="main-content" role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <!-- FOOTER -->
    <footer class="">
        <div class="container text-center">
            <p class="mb-1">&copy; 2025 - Digital Valgportal</p>
            <p class="small">
                <a asp-controller="Home" asp-action="Privacy">Personvern</a> |
                <a asp-controller="Home" asp-action="Contact">Kontakt</a> |
                <a asp-controller="Home" asp-action="Accessibility">Tilgjengelighet</a> |
                <a href="mailto:valg@valg.no">Kontakt oss</a>
            </p>
        </div>
    </footer>

    <!-- JS -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap-grid.min.css" /> -->
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
