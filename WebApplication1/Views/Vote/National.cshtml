@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    ViewData["Title"] = "Stortingsvalg 2025 ‚Äì Digital Valgportal";
    var navn = ViewBag.UserFullName as string ?? "Velger";
    var parties = ViewBag.Parties as List<string> ?? new List<string>();
    var message = TempData["VoteMessage"] as string;
}

<style>
    .party-card {
        transition: all 0.3s ease;
        width: 200px;
        height: 160px;
        flex-shrink: 0;
    }

    .party-card:hover .card-content {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .party-card input[type="radio"] {
        display: none !important;
        position: absolute !important;
        opacity: 0 !important;
        pointer-events: none !important;
    }

    .party-card input[type="radio"]:checked + .card-content {
        background-color: #0067C5 !important;
        border-color: #0067C5 !important;
    }

    .party-card input[type="radio"]:checked + .card-content .party-name {
        color: white !important;
        font-weight: 600;
    }

    .card-content {
        border: 2px solid #e5e7eb !important;
        width: 200px;
        height: 160px;
        transition: all 0.3s ease;
    }

    .party-grid {
        display: grid;
        grid-template-columns: repeat(5, 200px);
        gap: 1rem;
        justify-content: center;
    }

    @@media (max-width: 1200px) {
    .party-grid {
        grid-template-columns: repeat(4, 200px);
    }
    }

    @@media (max-width: 950px) {
    .party-grid {
        grid-template-columns: repeat(3, 200px);
    }
    }

    @@media (max-width: 700px) {
    .party-grid {
        grid-template-columns: repeat(2, 200px);
    }
    }

    @@media (max-width: 450px) {
    .party-grid {
        grid-template-columns: repeat(1, 200px);
    }
    }

    .stats-card {
        background: #ffffff;
        border-radius: 0.5rem;
        padding: 2rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
    }

    .instruction-card {
        background: #ffffff;
        border-radius: 0.5rem;
        padding: 2rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
    }

    #party-details {
        transition: opacity 0.3s ease, transform 0.3s ease;
    }

    #party-details.show {
        opacity: 1;
        transform: translateY(0);
    }
</style>

<section class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 py-8 px-4">
    <div class="max-w-7xl mx-auto space-y-6">

        <!-- Top banner -->
        <div class="bg-white border-l-4 border-blue-600 rounded-lg shadow-sm p-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900 mb-1">Stortingsvalg 2025</h1>
                    <p class="text-gray-600">Digital valgportal</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-500 mb-1">Innlogget som</p>
                    <p class="text-lg font-semibold text-gray-900">@navn</p>
                </div>
            </div>
            <a asp-controller="Home" asp-action="Index"
               class="mt-4 inline-block px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all font-medium text-center">
                ‚Üê Tilbake til forsiden
            </a>
        </div>

        <!-- Success/Error message -->
        @if (!string.IsNullOrEmpty(message))
        {
            <div class="bg-white rounded-lg shadow-sm border-l-4 border-green-500 p-4">
                <div class="flex items-center">
                    <svg class="h-5 w-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <p class="text-green-800 font-medium">@message</p>
                </div>
            </div>
        }

        <!-- Instructions section -->
        <div class="instruction-card">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Slik avgir du stemme</h2>
            <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto mb-6">
                <div class="text-center">
                    <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-3">1</div>
                    <p class="text-gray-700 font-medium">Velg partiet du √∏nsker √• stemme p√•</p>
                </div>
                <div class="text-center">
                    <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-3">2</div>
                    <p class="text-gray-700 font-medium">Kontroller at ditt valg er riktig</p>
                </div>
                <div class="text-center">
                    <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-xl font-bold mx-auto mb-3">3</div>
                    <p class="text-gray-700 font-medium">Bekreft ved √• trykke "Avgi stemme"</p>
                </div>
            </div>
            <div class="p-4 bg-blue-50 rounded-lg border border-blue-200 max-w-2xl mx-auto">
                <p class="text-sm text-gray-700 text-center">
                    <strong class="text-blue-800">Viktig:</strong> N√•r du har avgitt stemme, kan den ikke endres. Stemmen din er anonym og kryptert.
                </p>
            </div>
        </div>

        <!-- Voting form -->
        <div class="stats-card">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Velg parti</h2>
            <form id="voteForm" asp-action="SubmitVote" method="post">
                <div class="flex flex-wrap gap-4 justify-center">
                    @foreach (var party in parties)
                    {
                        <label class="party-card cursor-pointer block">
                            <input type="radio" id="@party" name="party" value="@party" required data-party="@party" />
                            <div class="card-content border-2 border-gray-200 rounded-lg p-4 bg-white flex items-center justify-center text-center">
                                <span class="party-name text-gray-900 font-semibold text-sm leading-tight">@party</span>
                            </div>
                        </label>
                    }
                </div>
            </form>
        </div>

        <!-- Party Details Section (Initially Hidden) -->
        <div id="party-details" class="stats-card" style="display: none;">
            <button class="px-4 py-2 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-all mb-4" onclick="closeDetails()">‚úï Lukk</button>
            <h4 id="detail-party-name" class="text-2xl font-bold text-gray-900 mb-4"></h4>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h6 class="text-lg font-semibold mb-3">üìã Partiinformasjon</h6>
                    <div id="detail-info" class="space-y-2"></div>
                </div>
                <div>
                    <h6 class="text-lg font-semibold mb-3">üéØ Hovedsaker</h6>
                    <div id="detail-issues" class="space-y-2"></div>
                </div>
            </div>
        </div>

        <!-- Submit button box -->
        <div class="stats-card">
            <div class="flex justify-center">
                <button type="submit" form="voteForm"
                        class="px-16 py-5 bg-blue-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-blue-700 hover:shadow-lg transition-all">
                    Avgi stemme ‚Üí
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-sm text-gray-600 mt-6">
            <p>Sikret med moderne kryptering | Din stemme er anonym | St√∏ttes av Valgdirektoratet</p>
        </div>
    </div>
</section>

<script>
    // Party information database
    const partyInfo = {
        'Arbeiderpartiet': {
            leader: 'Jonas Gahr St√∏re',
            founded: '1887',
            ideology: 'Sosialdemokrati',
            issues: ['Velferdsstaten', 'Jobber og n√¶ringsliv', 'Klimatiltak', 'Rettferdig fordeling']
        },
        'H√∏yre': {
            leader: 'Erna Solberg',
            founded: '1884',
            ideology: 'Konservatisme',
            issues: ['Entrepren√∏rskap', 'Lavere skatter', 'Utdanning', 'Trygghet']
        },
        'Senterpartiet': {
            leader: 'Trygve Slagsvold Vedum',
            founded: '1920',
            ideology: 'Senterorientering',
            issues: ['Distriktspolitikk', 'Landbruk', 'Desentralisering', 'Nasjonal kontroll']
        },
        'Fremskrittspartiet': {
            leader: 'Sylvi Listhaug',
            founded: '1973',
            ideology: 'Liberalkonservatisme',
            issues: ['Lavere skatter', 'Mindre byr√•krati', 'Streng innvandring', 'Veier og transport']
        },
        'Sosialistisk Venstreparti': {
            leader: 'Kirsti Bergst√∏',
            founded: '1975',
            ideology: 'Demokratisk sosialisme',
            issues: ['Klimarettferdighet', '√òkonomisk likhet', 'Fellesskap', 'Velferd']
        },
        'R√∏dt': {
            leader: 'Marie Sneve Martinussen',
            founded: '2007',
            ideology: 'Sosialisme',
            issues: ['Arbeiderrettigheter', 'Gratis velferd', 'Klimaomstilling', '√òkonomisk rettferdighet']
        },
        'Venstre': {
            leader: 'Guri Melby',
            founded: '1884',
            ideology: 'Sosialliberalisme',
            issues: ['Klima og milj√∏', 'Utdanning', 'Frihet', 'N√¶ringsutvikling']
        },
        'Kristelig Folkeparti': {
            leader: 'Dag Inge Ulstein',
            founded: '1933',
            ideology: 'Kristendemokrati',
            issues: ['Familie og barn', 'Verdier', 'Omsorg', 'Rusforebygging']
        },
        'Milj√∏partiet De Gr√∏nne': {
            leader: 'Arild Hermstad',
            founded: '1988',
            ideology: 'Gr√∏nn politikk',
            issues: ['Klimakutt', 'B√¶rekraft', 'Biologisk mangfold', 'Milj√∏vern']
        },
        'Innsamslingspartie': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Partiet De Kristne': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Demokratene': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Liberalistene': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Pensjonspartiet': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Kystpartiet': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Alliansen': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Norges Kommunistiske Parti': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Piratpartiet': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Helsepartiet': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Folkestyret': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Norsk Republikanske Allianse': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Verdipartiet': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
        'Partiet Sentrum': {
            leader: 's',
            founded: 's',
            ideology: 's',
            issues: ['s', 's', 's', 's']
        },
    };

    let selectedParty = null;

    document.querySelectorAll('.party-card input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', function () {
            // Reset all cards
            document.querySelectorAll('.party-card .card-content').forEach(card => {
                card.style.backgroundColor = '#FFFFFF';
                card.style.borderColor = '#e5e7eb';
                const name = card.querySelector('.party-name');
                name.style.color = '#111827';
                name.style.fontWeight = '600';
            });

            // Highlight selected card
            if (this.checked) {
                const card = this.nextElementSibling;
                card.style.backgroundColor = '#0067C5';
                card.style.borderColor = '#0067C5';
                const name = card.querySelector('.party-name');
                name.style.color = '#FFFFFF';
                name.style.fontWeight = '600';

                // Show party details
                selectedParty = this.getAttribute('data-party');
                showPartyDetails(selectedParty);
            }
        });
    });

    function showPartyDetails(partyName) {
        const detailsDiv = document.getElementById('party-details');
        const partyNameTitle = document.getElementById('detail-party-name');
        const infoDiv = document.getElementById('detail-info');
        const issuesDiv = document.getElementById('detail-issues');

        partyNameTitle.textContent = partyName;

        const info = partyInfo[partyName];

        if (info) {
            infoDiv.innerHTML = `
                <p class="text-gray-700"><strong>Partileder:</strong> ${info.leader}</p>
                <p class="text-gray-700"><strong>Grunnlagt:</strong> ${info.founded}</p>
                <p class="text-gray-700"><strong>Ideologi:</strong> ${info.ideology}</p>
            `;

            issuesDiv.innerHTML = '<ul class="list-disc list-inside space-y-1">' +
                info.issues.map(issue => `<li class="text-gray-700">${issue}</li>`).join('') +
                '</ul>';
        } else {
            infoDiv.innerHTML = '<p class="text-gray-700">Informasjon om dette partiet er ikke tilgjengelig.</p>';
            issuesDiv.innerHTML = '<p class="text-gray-700">Hovedsaker er ikke tilgjengelige.</p>';
        }

        detailsDiv.style.display = 'block';
        detailsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function closeDetails() {
        document.getElementById('party-details').style.display = 'none';
    }
</script>